<!DOCTYPE html>
<html lang="en">
<head th:replace="~{../static/fragments/head/head.html::head('Lista de Instituições', 'style')}"></head>
<!--
<head>
    <meta charset="UTF-8">
    <title>Lista de Instituições</title>
    <link rel="stylesheet" type="text/css" href="http://localhost:8080/css/style.css" />
    <link th:rel="stylesheet" th:href="@{/webjars/bootstrap/css/bootstrap.css} "/>
    <link th:rel="stylesheet" th:href="@{/webjars/font-awesome/css/font-awesome.min.css} "/>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100&display=swap" rel="stylesheet">
</head>
-->
<body>
<div id="header" th:replace="~{../static/fragments/header/header.html::headerGeral}"></div>

<div id="searchGroup">
    <!-- Nome -->
    <div id="nomeFiltroInst">
        <label for="searchNome"> Nome da Instituição </label>
        <input type="text" id="searchNome">
    </div>

    <!-- Causa -->
    <div id="causaFiltroInst">
        <label for="searchCausa"> Causa da Instituição </label>
        <input type="text" id="searchCausa">
    </div>

    <!-- Necessidades -->
    <div id="categoriaFiltro">
        <label> Necessidades: </label>
        <select id="searchNecessidade">
            <option value="" selected> Necessidades... </option>
            <option value="Alimentos"> Alimentos </option>
            <option value="Remédios"> Remédios </option>
            <option value="Educação"> Educação </option>
            <option value="Vestimentas"> Vestimentas </option>
            <option value="Produtos para Pets"> Produtos para Pets </option>
            <option value="Outros fins"> Outros fins </option>
        </select>
    </div>
</div>
    <!--
    <header>
        <div id="content" class="mx-auto w-75 pt-3">
            <div id="logged">
                <p> Olá, <span th:text="${dadosDoador.usuarioDoador.nomeUsuario}"> nome </span> </p>
            </div>
            <div>
                <p> <a href="/doadores/dados"> Seus dados </a> </p>
            </div>
            <div id="logout">
                <a href="/"> Deslogar </a><br><br>
            </div>
        </div>
        <div id="title">
            <h2> Instituições </h2>
        </div>
    </header>-->
    <div id="instituicaoAll">
        <div class="card" id="instituicaoList">
            <!-- Div na qual cards de Instituicoes sera carregado -->
        </div>
        <div id="paginacao">
            <!-- Carregar indices de paginas -->
        </div>
    </div>
    <div id="footer" th:replace="~{../static/fragments/footer/footer.html::footer}"> </div>
    <!--
    <div th:with="quantidade = ${#lists.size(instituicoes)}" th:style="${quantidade} >= 5 ? 'position: relative' : 'position: fixed'" class="body-footer" id="footer">
        <footer>
            <div class="container">
                <div class="sec about-us" align="center">
                    <h2>Sobre <span id="bolder">Nós</span></h2>
                    <p>
                        Somos uma comunidade que tem como principal característica o companheirismo. Sempre que nós vemos alguém passando por necessidades nós percebemos que temos que agir. Um por todos e todos por um!
                    </p>
                    <ul class="sci" align="center">
                        <li><a href="#"><i class="fa fa-facebook" aria-hidden="true"></i></a></li>
                        <li><a href="#"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
                        <li><a href="#"><i class="fa fa-instagram" aria-hidden="true"></i></a></li>
                        <li><a href="#"><i class="fa fa-youtube-play" aria-hidden="true"></i></a></li>
                        <li><a href="#"><i class="fa fa-github" aria-hidden="true"></i></a></li>
                    </ul>
                </div>
                <div class="sec talk-to-us" align="center">
                    <h2>Fale <span id="bolder">Conosco</span></h2>
                    <ul class="info">
                        <li>
                            <span><i class="fa fa-envelope" aria-hidden="true"></i></span>
                            <p><a href="mailto: reply@capratvagas.com.br">reply@redonate.com.br</a></p>
                        </li>
                        <li>
                            <span><i class="fa fa-phone" aria-hidden="true"></i></span>
                            <p><a href="tel: 551125658450">+55 11 2565-8450</a></p>
                        </li>
                        <li>
                            <span><i class="fa fa-map-marker" aria-hidden="true"></i></span>
                            <span>Av. Salgado Filho, 3501 <br>Guarulhos, São Paulo, Brasil</span>
                        </li>
                    </ul>
                </div>
            </div>
        </footer>
        <div class="copyright">
            <p>© Copyright 2021 ReDonate. Todos os direitos reservados.</p>
        </div>
    </div>-->

    <script th:src="@{/webjars/jquery/jquery.min.js}"></script>

    <!-- Mensagens sobre o estado do sistema para o usuário -->
    <script th:inline="javascript">
        /*<![CDATA[*/

        let sucesso = /*[[${success}]]*/ 'resultado da doação';
        if(sucesso != null){
            if(sucesso)
                window.alert("Doação efetuada com sucesso!");
            else
                window.alert("Erro ao efetuar doação!");
        }

        /*]]>*/
    </script>

    <!-- Tratamento dos filtros da lista -->
    <script>
        function carregarDados(objeto) {
            objeto.nome = $("#searchNome").val();
            objeto.causa = $("#searchCausa").val();
            objeto.necessidade = $("#searchNecessidade").val();
        }

        function visualizarFiltro(dados, elementoCard, elementoPag){

            saida = "";
            for(let i = 0; i < dados.length; i++){
                saida += "<dl class=\"instituicoes\">"
                saida +=     "<img class=\"card-img-top\" src=\"http://localhost:8080/images/smile-regular.svg\" alt=\"Card image cap\">"
                saida +=     "<div class=\"card-body\">"
                saida +=         "<h5 class=\"card-title\">" + dados[i].nomeUsuario + "</h5>"
                saida +=         "<dt>"
                saida +=            "<span> " + dados[i].instituicao.causaInstituicao + " </span>"
                saida +=         "</dt>"
                saida +=         "<a href = \"/instituicao/"+ dados[i].instituicao.id +"\" class=\"btn btn-primary\">Doar!</a>"
                saida +=     "</div>"
                saida += "</dl>"
            }

            for(let j = 0; j < (dados.length / 1); j++){
                let indice = document.createElement("span");
                indice.setAttribute("id", j);
                indice.innerHTML = j+1;
                elementoPag.append(indice);
            }

            $("#footer").css({"position": "fixed", "bottom": 0});

            elementoCard.html(saida);
        }

        function executarChamada(rota, objeto, elementoCard, elementoPag){
            carregarDados(objeto);
            let retorno;

            $.ajax({
               method: "GET",
               dataType: "json",
               url: rota,
               data: objeto,
               async: false,
               success: function (data, status) {
                   visualizarFiltro(data, elementoCard, elementoPag);
                   retorno = [...data];
               }
            });

            return retorno;
        }

        $(document).ready(function () {
            const instituicaoBox = $("#instituicaoList");
            const paginacaoList = $("#paginacao");
            const jsonFiltro = {};
            let Dados;

            //Carregar todas as Instituicoes
            Dados = executarChamada("http://localhost:8080/instituicoes/filtro", jsonFiltro, instituicaoBox, paginacaoList);

            //Iniciando refatoração de código para implementar paginação.
            console.log("\n\n" + Dados[0].nomeUsuario + "\n\n");

            //Detectar eventos de filtro e buscar Instituicoes filtradas
            $("#searchNome").on("input", function (e) {
                executarChamada("http://localhost:8080/instituicoes/filtro", jsonFiltro, instituicaoBox, paginacaoList);
            })

            $("#searchCausa").on("input", function (e) {
                executarChamada("http://localhost:8080/instituicoes/filtro", jsonFiltro, instituicaoBox, paginacaoList);
            })

            $("#searchNecessidade").change(function (e) {
                executarChamada("http://localhost:8080/instituicoes/filtro", jsonFiltro, instituicaoBox, paginacaoList);
            })
        });
    </script>
</body>
</html>